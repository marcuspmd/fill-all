<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>src/lib/form/detectors/strategies/chrome-ai-classifier.ts - docs-kit</title>
  <meta name="description" content="Documentation generated by docs-kit for your codebase">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" id="hljs-light">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" id="hljs-dark" disabled>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/rust.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/php.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/ruby.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/java.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/csharp.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/dart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/markdown.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/sql.min.js"></script>
  <script>
    // Apply theme immediately to prevent flash
    (function() {
      var stored = localStorage.getItem('docs-kit-theme');
      var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      var isDark = stored === 'dark' || (!stored && prefersDark);
      if (isDark) document.documentElement.classList.add('dark');
    })();
  </script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
          colors: {
            primary: '#2563eb',
            secondary: '#475569',
          },
          typography: {
            DEFAULT: {
              css: {
                'code::before': { content: '""' },
                'code::after': { content: '""' },
                // Don't override syntax highlighting
                'pre': {
                  backgroundColor: 'transparent !important',
                  color: 'inherit !important',
                  padding: '0',
                },
                'pre code': {
                  backgroundColor: 'transparent !important',
                  color: 'inherit !important',
                },
                // Only style inline code (not inside pre)
                ':not(pre) > code': {
                  backgroundColor: '#f1f5f9',
                  color: '#1e293b',
                  padding: '0.125rem 0.25rem',
                  borderRadius: '0.25rem',
                  fontWeight: '400',
                },
              },
            },
            invert: {
              css: {
                'pre': {
                  backgroundColor: 'transparent !important',
                  color: 'inherit !important',
                },
                ':not(pre) > code': {
                  backgroundColor: '#334155',
                  color: '#e2e8f0',
                },
              },
            },
          },
        }
      }
    }
  </script>
  <style>
    /* Dark mode transitions */
    html { transition: background-color 0.2s ease, color 0.2s ease; }
    .dark { color-scheme: dark; }

    /* Preserve highlight.js syntax highlighting */
    pre code.hljs {
      background: transparent !important;
      padding: 0 !important;
    }

    /* Code block backgrounds that work with highlight.js */
    pre {
      background-color: #f8fafc;
      border-radius: 0.375rem;
    }

    .dark pre {
      background-color: #1e293b;
    }

    /* Ensure highlight.js colors are visible */
    pre code {
      display: block;
      overflow-x: auto;
      color: inherit !important;
      background: transparent !important;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200">
  <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-30">
    <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex items-center">
          <div class="flex-shrink-0 flex items-center gap-3">
            <img src="../assets/logo.png" alt="Docs Kit MCP" class="h-10 w-10" />
            <div class="flex flex-col">
              <span class="text-xl font-bold text-blue-600 dark:text-blue-400">Docs Kit MCP</span>
              <span class="text-xs text-gray-500 dark:text-gray-400 font-medium">living connection between code & knowledge</span>
            </div>
          </div>
        </div>
        <div class="flex-1 flex items-center justify-center px-2 lg:ml-6 lg:justify-end">
          <div class="max-w-lg w-full lg:max-w-xs relative" id="global-search-wrap">
            <label for="global-search" class="sr-only">Search</label>
            <div class="relative">
              <input id="global-search" class="block w-full pl-3 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md leading-5 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="Search symbols..." type="search" autocomplete="off" aria-expanded="false" aria-haspopup="listbox" aria-controls="global-search-results">
              <div id="global-search-results" role="listbox" class="absolute left-0 right-0 mt-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg max-h-80 overflow-auto z-50 hidden" aria-label="Search results"></div>
            </div>
          </div>
          <!-- Theme Toggle Button -->
          <button id="theme-toggle" type="button" class="ml-4 p-2 rounded-md text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Toggle dark mode">
            <svg id="theme-icon-light" class="w-5 h-5 hidden dark:block" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"/>
            </svg>
            <svg id="theme-icon-dark" class="w-5 h-5 block dark:hidden" fill="currentColor" viewBox="0 0 20 20">
              <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </header>

  <div class="flex min-h-[calc(100vh-4rem)] overflow-x-hidden">
    <aside class="w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 hidden md:block flex-shrink-0">
      <div class="px-6 pt-2 pb-6 sticky max-h-[calc(100vh-4rem)] overflow-y-auto">
        <h3 class="px-3 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Navigation</h3>
        <nav class="space-y-1">
          <a href="../index.html" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">Dashboard</a><a href="../files.html" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">Files</a><a href="../relationships.html" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">Relationships</a><a href="../patterns.html" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">Patterns</a>
        </nav>

        <h3 class="px-3 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mt-8 mb-2">Documentation</h3>
        <nav class="space-y-1">
          <a href="../docs.html" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">All Docs</a>
          
          <div class="mt-1">
            <span class="block px-4 py-1 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">docs</span>
            <a href="../docs/ai-pipeline.html" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white pl-6">Ai Pipeline</a><a href="../docs/architecture.html" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white pl-6">Architecture</a><a href="../docs/contributing.html" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white pl-6">Contributing</a><a href="../docs/generators.html" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white pl-6">Generators</a><a href="../docs/modules.html" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white pl-6">Modules</a>
          </div>
          <div class="mt-1">
            <span class="block px-4 py-1 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Main</span>
            <a href="../README.html" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white pl-6">README</a>
          </div>
        </nav>

        <h3 class="px-3 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mt-8 mb-2">Health</h3>
        <nav class="space-y-1">
          <a href="../deprecated.html" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">Deprecated</a>
          <a href="../governance.html" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">Violations</a>
          <a href="../index.html#high-impact-symbols" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">High impact</a>
        </nav>

        <h3 class="px-3 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mt-8 mb-2">Quick Links</h3>
        <nav class="space-y-1">
          <a href="../index.html#code-metrics" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">Code metrics</a>
          <a href="../index.html#architecture-overview" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">Architecture</a>
          <a href="../index.html#architecture-layers" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">Layers</a>
          <a href="../index.html#top-complex-symbols" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">Complexity</a>
          <a href="../relationships.html" class="block px-4 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">All Relationships</a>
        </nav>
      </div>
    </aside>

    <main class="flex-1 focus:outline-none px-6 py-2 lg:px-8 lg:py-3 min-w-0 overflow-x-auto" id="content" role="main">
      
    <nav class="flex mb-6" aria-label="Breadcrumb">
       <ol class="flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400">
         <li><a href="../index.html" class="hover:text-gray-700 dark:hover:text-gray-300">Dashboard</a></li>
         <li><svg class="flex-shrink-0 h-5 w-5 text-gray-300 dark:text-gray-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></li>
         <li><span class="text-gray-900 dark:text-white font-semibold">src/lib/form/detectors/strategies/chrome-ai-classifier.ts</span></li>
       </ol>
    </nav>

    <h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center">
      <svg class="h-8 w-8 text-gray-400 dark:text-gray-500 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
      src/lib/form/detectors/strategies/chrome-ai-classifier.ts
    </h1>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
      <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg border border-gray-200 dark:border-gray-700 p-4 text-center">
        <dt class="text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Total Symbols</dt>
        <dd class="mt-1 text-2xl font-semibold text-gray-900 dark:text-white">8</dd>
      </div>
      <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg border border-gray-200 dark:border-gray-700 p-4 text-center">
        <dt class="text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Lines of Code</dt>
        <dd class="mt-1 text-2xl font-semibold text-gray-900 dark:text-white">303</dd>
      </div>
      <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg border border-gray-200 dark:border-gray-700 p-4 text-center">
        <dt class="text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Avg Complexity</dt>
        <dd class="mt-1 text-2xl font-semibold text-gray-900 dark:text-white">6.5</dd>
      </div>
      
      <div class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg border border-gray-200 dark:border-gray-700 p-4 text-center">
        <dt class="text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Symbol Types</dt>
        <dd class="mt-1 text-2xl font-semibold text-gray-900 dark:text-white">3</dd>
      </div>
    </div>

    
    <div class="mb-12">
      <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">File Relationships</h2>
      <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6 border border-gray-200 dark:border-gray-700 overflow-x-auto">
        <div class="mermaid-expand-wrapper relative group" data-mermaid-src-base64="Z3JhcGggTFIKICBidWlsZFByb21wdFsiYnVpbGRQcm9tcHQiXQogIGdldENvbnRleHRIdG1sWyJnZXRDb250ZXh0SHRtbCJdCiAgZGV0ZWN0QXN5bmNbImRldGVjdEFzeW5jIl0KICBnZXRPckNyZWF0ZVNlc3Npb25bImdldE9yQ3JlYXRlU2Vzc2lvbiJdCiAgcGFyc2VSZXNwb25zZVsicGFyc2VSZXNwb25zZSJdCiAgYnVpbGRQcm9tcHQgLS0+fGNhbGxzfCBnZXRDb250ZXh0SHRtbAogIGRldGVjdEFzeW5jIC0tPnxjYWxsc3wgZ2V0T3JDcmVhdGVTZXNzaW9uCiAgZGV0ZWN0QXN5bmMgLS0+fGNhbGxzfCBidWlsZFByb21wdAogIGRldGVjdEFzeW5jIC0tPnxjYWxsc3wgcGFyc2VSZXNwb25zZQogIGNsaWNrIGJ1aWxkUHJvbXB0ICIuLi9zeW1ib2xzL2Q2NDY3NjRhZjk1Y2EwMjEuaHRtbCIKICBjbGljayBnZXRDb250ZXh0SHRtbCAiLi4vc3ltYm9scy83NjU1MTVkNmIzZDQ0M2I2Lmh0bWwiCiAgY2xpY2sgZGV0ZWN0QXN5bmMgIi4uL3N5bWJvbHMvMjVhYjEyYjAyZWU2NmZhZi5odG1sIgogIGNsaWNrIGdldE9yQ3JlYXRlU2Vzc2lvbiAiLi4vc3ltYm9scy85M2JiYWJhZjdlNjI5NjNmLmh0bWwiCiAgY2xpY2sgcGFyc2VSZXNwb25zZSAiLi4vc3ltYm9scy83ZmM2MWUxNGM4NDMzZDhmLmh0bWwi">
  <div class="mermaid">graph LR
  buildPrompt["buildPrompt"]
  getContextHtml["getContextHtml"]
  detectAsync["detectAsync"]
  getOrCreateSession["getOrCreateSession"]
  parseResponse["parseResponse"]
  buildPrompt -->|calls| getContextHtml
  detectAsync -->|calls| getOrCreateSession
  detectAsync -->|calls| buildPrompt
  detectAsync -->|calls| parseResponse
  click buildPrompt "../symbols/d646764af95ca021.html"
  click getContextHtml "../symbols/765515d6b3d443b6.html"
  click detectAsync "../symbols/25ab12b02ee66faf.html"
  click getOrCreateSession "../symbols/93bbabaf7e62963f.html"
  click parseResponse "../symbols/7fc61e14c8433d8f.html"</div>
  <button type="button" class="mermaid-expand-btn absolute top-2 right-2 z-10 px-2 py-1 text-xs font-medium rounded bg-white/90 dark:bg-gray-800/90 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 shadow hover:bg-white dark:hover:bg-gray-700 hover:border-blue-400 dark:hover:border-blue-500 opacity-70 group-hover:opacity-100 transition-opacity" title="Expand to fullscreen (zoom and pan)">Expand</button>
</div>
      </div>
    </div>

    
    <div class="mb-12">
      <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Architecture violations</h2>
      <p class="text-sm text-gray-600 dark:text-gray-400 mb-4"><a href="../governance.html#arch" class="text-blue-600 dark:text-blue-400 hover:underline">View all</a></p>
      <ul class="list-disc list-inside space-y-1 text-sm text-gray-700 dark:text-gray-300">
        <li><span class="font-medium text-amber-700 dark:text-amber-400">[warning]</span> max-cyclomatic-complexity: 'detectAsync' has cyclomatic complexity 21 (max 10)</li>
      </ul>
    </div>

    <div class="mb-12">
      <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Symbols by Kind</h2>
      <div class="flex flex-wrap gap-4">
        
          <div class="bg-white dark:bg-gray-800 shadow rounded-lg px-4 py-2 border border-gray-200 dark:border-gray-700 flex items-center space-x-2">
            <span class="px-2 py-0.5 rounded text-xs font-medium border bg-yellow-50 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-300 border-yellow-200 dark:border-yellow-800">function</span>
            <span class="text-gray-900 dark:text-white font-semibold">5</span>
          </div>
          <div class="bg-white dark:bg-gray-800 shadow rounded-lg px-4 py-2 border border-gray-200 dark:border-gray-700 flex items-center space-x-2">
            <span class="px-2 py-0.5 rounded text-xs font-medium border bg-purple-50 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300 border-purple-200 dark:border-purple-800">method</span>
            <span class="text-gray-900 dark:text-white font-semibold">2</span>
          </div>
          <div class="bg-white dark:bg-gray-800 shadow rounded-lg px-4 py-2 border border-gray-200 dark:border-gray-700 flex items-center space-x-2">
            <span class="px-2 py-0.5 rounded text-xs font-medium border bg-green-50 dark:bg-green-900/50 text-green-700 dark:text-green-300 border-green-200 dark:border-green-800">interface</span>
            <span class="text-gray-900 dark:text-white font-semibold">1</span>
          </div>
      </div>
    </div>

    <div class="mb-12">
      <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">All Symbols</h2>
      <div class="bg-white dark:bg-gray-800 shadow overflow-x-auto sm:rounded-lg border border-gray-200 dark:border-gray-700">
        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
          <thead class="bg-gray-50 dark:bg-gray-700">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Name</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Kind</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Visibility</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Lines</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Signature</th>
            </tr>
          </thead>
          <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
            <tr>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600 dark:text-blue-400"><a href="../symbols/93bbabaf7e62963f.html" class="hover:underline">getOrCreateSession</a></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"><span class="px-2 py-0.5 rounded text-xs font-medium border bg-yellow-50 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-300 border-yellow-200 dark:border-yellow-800">function</span></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">-</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">74-92</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-500 dark:text-gray-400 text-xs"><code>getOrCreateSession(): : Promise&lt;LanguageModelSession | null&gt;</code></td>
            </tr>
            <tr>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600 dark:text-blue-400"><a href="../symbols/ea6bcd97e82e40b3.html" class="hover:underline">destroyClassifierSession</a></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"><span class="px-2 py-0.5 rounded text-xs font-medium border bg-yellow-50 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-300 border-yellow-200 dark:border-yellow-800">function</span></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"><span class="px-2 py-0.5 rounded text-xs font-medium border bg-blue-50 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 border-blue-200 dark:border-blue-800 ml-2">exported</span>-</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">95-100</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-500 dark:text-gray-400 text-xs"><code>destroyClassifierSession(): : void</code></td>
            </tr>
            <tr>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600 dark:text-blue-400"><a href="../symbols/765515d6b3d443b6.html" class="hover:underline">getContextHtml</a></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"><span class="px-2 py-0.5 rounded text-xs font-medium border bg-yellow-50 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-300 border-yellow-200 dark:border-yellow-800">function</span></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">-</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">113-133</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-500 dark:text-gray-400 text-xs"><code>getContextHtml(el: HTMLElement): : string | null</code></td>
            </tr>
            <tr>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600 dark:text-blue-400"><a href="../symbols/d646764af95ca021.html" class="hover:underline">buildPrompt</a></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"><span class="px-2 py-0.5 rounded text-xs font-medium border bg-yellow-50 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-300 border-yellow-200 dark:border-yellow-800">function</span></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">-</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">135-158</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-500 dark:text-gray-400 text-xs"><code>buildPrompt(field: FormField): : string</code></td>
            </tr>
            <tr>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600 dark:text-blue-400"><a href="../symbols/4b28ab2994a3f0e1.html" class="hover:underline">AiClassifierResult</a></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"><span class="px-2 py-0.5 rounded text-xs font-medium border bg-green-50 dark:bg-green-900/50 text-green-700 dark:text-green-300 border-green-200 dark:border-green-800">interface</span></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">-</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">162-165</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-500 dark:text-gray-400 text-xs"><code>interface AiClassifierResult</code></td>
            </tr>
            <tr>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600 dark:text-blue-400"><a href="../symbols/7fc61e14c8433d8f.html" class="hover:underline">parseResponse</a></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"><span class="px-2 py-0.5 rounded text-xs font-medium border bg-yellow-50 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-300 border-yellow-200 dark:border-yellow-800">function</span></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">-</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">167-205</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-500 dark:text-gray-400 text-xs"><code>parseResponse(raw: string): : AiClassifierResult | null</code></td>
            </tr>
            <tr>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600 dark:text-blue-400"><a href="../symbols/168c66cc6d1c1335.html" class="hover:underline">detect</a></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"><span class="px-2 py-0.5 rounded text-xs font-medium border bg-purple-50 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300 border-purple-200 dark:border-purple-800">method</span></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">-</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">216-218</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-500 dark:text-gray-400 text-xs"><code>detect(_field: FormField): : ClassifierResult | null</code></td>
            </tr>
            <tr>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600 dark:text-blue-400"><a href="../symbols/25ab12b02ee66faf.html" class="hover:underline">detectAsync</a></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"><span class="px-2 py-0.5 rounded text-xs font-medium border bg-purple-50 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300 border-purple-200 dark:border-purple-800">method</span></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm"></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">-</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">226-301</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-500 dark:text-gray-400 text-xs"><code>detectAsync(field: FormField): : Promise&lt;ClassifierResult | null&gt;</code></td>
            </tr>
            
          </tbody>
        </table>
      </div>
    </div>

    <div class="mb-12">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Full Source</h2>
            <div class="rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700">
              <pre class="p-4 overflow-x-auto text-sm font-mono leading-tight"><code class="language-typescript">/**
 * Chrome AI Field Classifier
 *
 * Uses the Chrome Built-in Language API (Gemini Nano, Chrome 131+) to classify
 * form fields via a structured JSON prompt that includes the element's raw HTML.
 *
 * Pipeline position: after TensorFlow, before html-fallback.
 *
 * Sync `detect()` always returns null — this classifier is async-only.
 * Async `detectAsync()` sends field HTML context to the AI, parses the JSON
 * response back into a { fieldType, confidence, generatorType } result, and
 * persists the classification to the learning store so TF.js can retrain.
 *
 * On any error (AI unavailable, timeout, parse failure) it returns null so
 * the pipeline continues to the html-fallback classifier.
 */

import { FIELD_TYPES, type FormField, type FieldType } from &quot;@/types&quot;;
import type { FieldClassifier, ClassifierResult } from &quot;../pipeline&quot;;
import { storeLearnedEntry } from &quot;@/lib/ai/learning-store&quot;;
import { invalidateClassifier } from &quot;./tensorflow-classifier&quot;;
import { addDatasetEntry } from &quot;@/lib/dataset/runtime-dataset&quot;;
import { createLogger } from &quot;@/lib/logger&quot;;

const log = createLogger(&quot;ChromeAIClassifier&quot;);

// ── Constants ─────────────────────────────────────────────────────────────────

const CLASSIFY_TIMEOUT_MS = 60000;
const MIN_CONFIDENCE = 0.6;

const VALID_FIELD_TYPES = new Set&lt;string&gt;(FIELD_TYPES);
const VALID_FIELD_TYPES_TEXT = FIELD_TYPES.join(&quot;, &quot;);

/**
 * Inline instructions embedded in every prompt so the model always has context,
 * regardless of whether the Chrome AI session supports systemPrompt.
 * This is the only reliable way to enforce JSON-only output with Gemini Nano.
 */
const INLINE_INSTRUCTIONS = `You are a form field type classifier for Brazilian web forms.
You will receive the raw HTML of an input element and its surrounding container.
Determine the semantic type of the field and which data generator should fill it.

You MUST respond ONLY with a JSON object in this exact format — no other text, no markdown, no explanation:
{&quot;fieldType&quot;: &quot;&lt;type&gt;&quot;, &quot;confidence&quot;: &lt;number&gt;, &quot;generatorType&quot;: &quot;&lt;generator&gt;&quot;}

Valid fieldType values:
${VALID_FIELD_TYPES_TEXT}

Valid generatorType values (same list — pick the most specific generator):
${VALID_FIELD_TYPES_TEXT}

Rules:
- Return ONLY the JSON object, nothing else. No introductory text.
- confidence is a float between 0.0 and 1.0.
- Use &quot;unknown&quot; when the field purpose is unclear.
- Only return confidence &gt;= ${MIN_CONFIDENCE} when you are reasonably sure.
- generatorType should match the most specific generator for the field
  (e.g. for a birth date field use &quot;birth-date&quot;, not just &quot;date&quot;).
- Analyse HTML attributes (name, id, placeholder, class, aria-label, autocomplete)
  as well as visible label text to determine the field purpose.

Example output: {&quot;fieldType&quot;: &quot;email&quot;, &quot;confidence&quot;: 0.98, &quot;generatorType&quot;: &quot;email&quot;}`;

// ── Session management ────────────────────────────────────────────────────────

// eslint-disable-next-line @typescript-eslint/no-explicit-any
const LanguageModelAPI = (globalThis as any).LanguageModel as
  | LanguageModelStatic
  | undefined;

let classifierSession: LanguageModelSession | null = null;

async function getOrCreateSession(): Promise&lt;LanguageModelSession | null&gt; {
  if (classifierSession) return classifierSession;

  try {
    if (!LanguageModelAPI) return null;

    const avail = await LanguageModelAPI.availability({ outputLanguage: &quot;en&quot; });
    if (avail === &quot;unavailable&quot;) return null;

    classifierSession = await LanguageModelAPI.create({
      outputLanguage: &quot;en&quot;,
    });

    return classifierSession;
  } catch (err) {
    log.warn(&quot;Falha ao criar sessão Chrome AI:&quot;, err);
    return null;
  }
}

/** Invalidates the cached session (call on extension unload or session error). */
export function destroyClassifierSession(): void {
  if (classifierSession) {
    classifierSession.destroy();
    classifierSession = null;
  }
}

// ── Prompt builder ────────────────────────────────────────────────────────────

/** Maximum characters to include from outerHTML to keep prompts concise. */
const MAX_ELEMENT_HTML_CHARS = 600;
const MAX_CONTEXT_HTML_CHARS = 500;

/**
 * Extracts the relevant surrounding container HTML for a field element.
 * Walks up the DOM looking for a wrapping label, fieldset or common
 * form-group patterns. Returns null when none is found.
 */
function getContextHtml(el: HTMLElement): string | null {
  const container =
    el.closest&lt;HTMLElement&gt;(
      'label, fieldset, [class*=&quot;field&quot;], [class*=&quot;group&quot;], [class*=&quot;form-&quot;], [class*=&quot;input-wrap&quot;]',
    ) ?? el.parentElement;

  if (!container || container === el) return null;

  // Avoid returning the entire &lt;form&gt; or &lt;body&gt;
  if (
    container.tagName === &quot;FORM&quot; ||
    container.tagName === &quot;BODY&quot; ||
    container.tagName === &quot;MAIN&quot;
  ) {
    return null;
  }

  const raw = container.outerHTML;
  if (raw.length &lt;= MAX_CONTEXT_HTML_CHARS) return raw;
  return raw.slice(0, MAX_CONTEXT_HTML_CHARS) + &quot;…&quot;;
}

function buildPrompt(field: FormField): string {
  const sections: string[] = [];

  // ── Section 1: raw element HTML ───────────────────────────────────────────
  const elementHtml = field.element.outerHTML;
  sections.push(
    `=== Element HTML ===\n${elementHtml.length &gt; MAX_ELEMENT_HTML_CHARS ? elementHtml.slice(0, MAX_ELEMENT_HTML_CHARS) + &quot;…&quot; : elementHtml}`,
  );

  // ── Section 2: surrounding container HTML (label + field wrapper) ─────────
  const contextHtml = getContextHtml(field.element as HTMLElement);
  if (contextHtml) {
    sections.push(`=== Surrounding HTML (container) ===\n${contextHtml}`);
  }

  // ── Section 3: pre-computed text signals (normalised label / name / id …) ──
  if (field.contextSignals?.trim()) {
    sections.push(`=== Field Signals ===\n${field.contextSignals}`);
  }

  // Inline instructions are always embedded to ensure JSON-only output,
  // since Gemini Nano may ignore session-level systemPrompt in some Chrome builds.
  return `${INLINE_INSTRUCTIONS}\n\nClassify this form field:\n\n${sections.join(&quot;\n\n&quot;)}`;
}

// ── Response parser ───────────────────────────────────────────────────────────

interface AiClassifierResult extends ClassifierResult {
  /** Generator the AI recommended for this field. */
  generatorType: FieldType;
}

function parseResponse(raw: string): AiClassifierResult | null {
  try {
    // Extract the first JSON-like object from the response, even if the model
    // adds surrounding text despite instructions.
    const match = raw.match(/\{[^{}]+\}/);
    if (!match) return null;

    const parsed = JSON.parse(match[0]) as {
      fieldType?: unknown;
      confidence?: unknown;
      generatorType?: unknown;
    };

    if (
      typeof parsed.fieldType !== &quot;string&quot; ||
      !VALID_FIELD_TYPES.has(parsed.fieldType) ||
      typeof parsed.confidence !== &quot;number&quot;
    ) {
      return null;
    }

    const type = parsed.fieldType as FieldType;
    const confidence = Math.max(0, Math.min(1, parsed.confidence));

    // Discard low-confidence and &quot;unknown&quot; results — let the fallback handle them.
    if (type === &quot;unknown&quot; || confidence &lt; MIN_CONFIDENCE) return null;

    // generatorType — must be a valid FieldType; falls back to fieldType.
    const rawGenerator =
      typeof parsed.generatorType === &quot;string&quot; &amp;&amp;
      VALID_FIELD_TYPES.has(parsed.generatorType)
        ? (parsed.generatorType as FieldType)
        : type;

    return { type, confidence, generatorType: rawGenerator };
  } catch {
    return null;
  }
}

// ── Classifier ────────────────────────────────────────────────────────────────

export const chromeAiClassifier: FieldClassifier = {
  name: &quot;chrome-ai&quot;,

  /**
   * Synchronous path — always returns null.
   * Chrome AI requires async I/O; use detectAsync() via runAsync().
   */
  detect(_field: FormField): ClassifierResult | null {
    return null;
  },

  /**
   * Async path — sends field HTML context to Gemini Nano and parses the JSON
   * reply. On success, persists the classification to the learning store so
   * TF.js prototype vectors are updated for future page loads.
   * Returns null on unavailability, timeout, or parse failure.
   */
  async detectAsync(field: FormField): Promise&lt;ClassifierResult | null&gt; {
    try {
      const session = await getOrCreateSession();
      if (!session) return null;

      const prompt = buildPrompt(field);

      const controller = new AbortController();
      const timeoutId = setTimeout(
        () =&gt; controller.abort(),
        CLASSIFY_TIMEOUT_MS,
      );

      let raw: string;
      try {
        log.debug(
          `Prompt for &quot;${field.contextSignals ?? field.name ?? field.id}&quot;:\n${prompt}`,
        );
        raw = await session.prompt(prompt, { signal: controller.signal });
        log.debug(
          `Raw response for &quot;${field.contextSignals ?? field.name ?? field.id}&quot;:\n${raw}`,
        );
      } finally {
        log.debug(
          `Response for &quot;${field.contextSignals ?? field.name ?? field.id}&quot;:\n${prompt ?? &quot;(no response)&quot;}`,
        );
        clearTimeout(timeoutId);
      }

      const result = parseResponse(raw);

      if (result) {
        log.debug(
          `&quot;${field.contextSignals ?? field.name ?? field.id}&quot; → ${result.type} (generator: ${result.generatorType}, ${(result.confidence * 100).toFixed(0)}%)`,
        );

        // ── Persist to dataset + learning store ───────────────────────────
        // The dataset is the source of truth for the learning store.
        // Both are updated so TF.js can retrain and the cosine classifier
        // benefits immediately on the next field classification.
        const signals = field.contextSignals ?? &quot;&quot;;
        if (signals) {
          addDatasetEntry({
            signals,
            type: result.type,
            source: &quot;auto&quot;,
            difficulty: &quot;easy&quot;,
          }).catch(() =&gt; {
            /* non-critical */
          });
          storeLearnedEntry(signals, result.type, result.generatorType)
            .then(() =&gt; invalidateClassifier())
            .catch(() =&gt; {
              /* non-critical — ignore storage errors */
            });
        }
      }

      // Return only the base ClassifierResult to keep the pipeline interface clean.
      return result
        ? { type: result.type, confidence: result.confidence }
        : null;
    } catch (err) {
      if (err instanceof Error &amp;&amp; err.name === &quot;AbortError&quot;) {
        // Timeout — log so the user can see what happened in DevTools.
        log.warn(
          `⏱ Timeout (${CLASSIFY_TIMEOUT_MS}ms) para &quot;${field.contextSignals ?? field.name ?? field.id}&quot; — passando para html-fallback`,
        );
      } else {
        // Session may be broken — reset so next call creates a fresh one.
        classifierSession = null;
        log.warn(&quot;Erro:&quot;, (err as Error).message);
      }
      return null;
    }
  },
};
</code></pre>
            </div>
           </div>

    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true,theme:'default',securityLevel:'loose',maxTextSize:300000});</script>
    
<div id="mermaid-fullscreen-modal" class="fixed inset-0 z-[100] hidden bg-black/80 flex items-center justify-center" aria-modal="true" role="dialog" style="display: none;">
  <div class="bg-white dark:bg-gray-800 w-full h-full flex flex-col">
    <div class="flex justify-between items-center p-3 border-b border-gray-200 dark:border-gray-700 flex-shrink-0">
      <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Diagram — zoom with mouse wheel, drag to pan</span>
      <div class="flex items-center gap-2">
        <button type="button" id="mermaid-zoom-out" class="w-8 h-8 rounded border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-lg leading-none text-gray-700 dark:text-gray-300" title="Zoom out">−</button>
        <button type="button" id="mermaid-zoom-in" class="w-8 h-8 rounded border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-lg leading-none text-gray-700 dark:text-gray-300" title="Zoom in">+</button>
        <button type="button" id="mermaid-reset-zoom" class="w-8 h-8 rounded border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-lg leading-none text-gray-700 dark:text-gray-300" title="Reset zoom">◉</button>
        <button type="button" id="mermaid-modal-close" class="px-3 py-1.5 rounded border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-sm font-medium text-gray-700 dark:text-gray-300">Close (ESC)</button>
      </div>
    </div>
    <div id="mermaid-modal-pan-wrap" class="flex-1 overflow-hidden relative bg-gray-50 dark:bg-gray-900" style="cursor: grab;">
      <div id="mermaid-modal-content" class="absolute inset-0 flex items-center justify-center" style="transform-origin: center center;"></div>
    </div>
  </div>
</div>
<script>
(function(){
  var modal = document.getElementById('mermaid-fullscreen-modal');
  var content = document.getElementById('mermaid-modal-content');
  var panWrap = document.getElementById('mermaid-modal-pan-wrap');
  var scale = 1, translateX = 0, translateY = 0;
  var isDragging = false, startX, startY, startTx, startTy;

  function applyTransform() {
    if (!content) return;
    var svg = content.querySelector('svg');
    if (svg) {
      svg.style.transform = 'translate(' + translateX + 'px, ' + translateY + 'px) scale(' + scale + ')';
      svg.style.transformOrigin = 'center center';
      svg.style.transition = 'transform 0.1s ease-out';
    }
  }

  function showModal() {
    if (modal) {
      modal.classList.remove('hidden');
      modal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }
  }

  function hideModal() {
    if (modal) {
      modal.classList.add('hidden');
      modal.style.display = 'none';
      document.body.style.overflow = '';
      if (content) content.innerHTML = '';
    }
  }

  // Use event delegation to handle expand button clicks (works even if buttons are added later)
  document.addEventListener('click', function(e) {
    var btn = e.target.closest('.mermaid-expand-btn');
    if (!btn) return;

    e.preventDefault();
    e.stopPropagation();

    var wrapper = btn.closest('.mermaid-expand-wrapper');
    if (!wrapper || !content) {
      console.warn('Mermaid: wrapper or content not found');
      return;
    }

    // Find the already-rendered SVG in the wrapper
    var mermaidDiv = wrapper.querySelector('.mermaid');
    if (!mermaidDiv) {
      console.warn('Mermaid: .mermaid element not found');
      return;
    }

    var svg = mermaidDiv.querySelector('svg');
    if (!svg) {
      console.warn('Mermaid: SVG not found - diagram may not be rendered yet');
      return;
    }

    try {
      // Clone the SVG and display it in the modal
      var svgClone = svg.cloneNode(true);

      // Reset SVG size constraints to allow it to scale properly
      svgClone.style.maxWidth = 'none';
      svgClone.style.maxHeight = 'none';
      svgClone.style.width = 'auto';
      svgClone.style.height = 'auto';
      svgClone.style.cursor = 'grab';

      // Disable all clickable links in the expanded view
      var links = svgClone.querySelectorAll('a');
      links.forEach(function(link) {
        link.style.pointerEvents = 'none';
        link.style.cursor = 'grab';
        link.removeAttribute('href');
        link.removeAttribute('xlink:href');
      });

      content.innerHTML = '';
      content.appendChild(svgClone);

      scale = 1;
      translateX = 0;
      translateY = 0;
      applyTransform();
      showModal();
    } catch (e) {
      console.error('Mermaid expand failed:', e);
    }
  });

  // Zoom controls
  if (document.getElementById('mermaid-zoom-in')) {
    document.getElementById('mermaid-zoom-in').addEventListener('click', function() {
      scale = Math.min(5, scale + 0.3);
      applyTransform();
    });
  }

  if (document.getElementById('mermaid-zoom-out')) {
    document.getElementById('mermaid-zoom-out').addEventListener('click', function() {
      scale = Math.max(0.2, scale - 0.3);
      applyTransform();
    });
  }

  if (document.getElementById('mermaid-reset-zoom')) {
    document.getElementById('mermaid-reset-zoom').addEventListener('click', function() {
      scale = 1;
      translateX = 0;
      translateY = 0;
      applyTransform();
    });
  }

  if (document.getElementById('mermaid-modal-close')) {
    document.getElementById('mermaid-modal-close').addEventListener('click', hideModal);
  }

  // Mouse wheel zoom
  if (panWrap) {
    panWrap.addEventListener('wheel', function(e) {
      e.preventDefault();
      var delta = e.deltaY > 0 ? 0.9 : 1.1;
      scale = Math.max(0.2, Math.min(5, scale * delta));
      applyTransform();
    }, { passive: false });
  }

  // Pan functionality
  if (panWrap) {
    panWrap.addEventListener('mousedown', function(e) {
      // Only pan if clicking on the background or SVG itself
      var svg = content.querySelector('svg');
      if (!svg) return;

      isDragging = true;
      startX = e.clientX;
      startY = e.clientY;
      startTx = translateX;
      startTy = translateY;
      panWrap.style.cursor = 'grabbing';
      if (svg) svg.style.cursor = 'grabbing';
    });

    document.addEventListener('mousemove', function(e) {
      if (isDragging) {
        translateX = startTx + e.clientX - startX;
        translateY = startTy + e.clientY - startY;
        applyTransform();
      }
    });

    document.addEventListener('mouseup', function() {
      if (isDragging) {
        isDragging = false;
        panWrap.style.cursor = 'grab';
        var svg = content.querySelector('svg');
        if (svg) svg.style.cursor = 'grab';
      }
    });
  }

  // Modal close handlers
  if (modal) {
    modal.addEventListener('click', function(e) {
      if (e.target === modal) hideModal();
    });

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && modal && !modal.classList.contains('hidden')) {
        hideModal();
      }
    });
  }

  // Prevent navigation from links inside modal content
  if (content) {
    content.addEventListener('click', function(e) {
      var link = e.target.closest('a');
      if (link) {
        e.preventDefault();
        e.stopPropagation();
        return false;
      }
    }, true);
  }
})();
</script>
  
    </main>

    
    <aside class="w-64 bg-white dark:bg-gray-800 border-l border-gray-200 dark:border-gray-700 hidden xl:block flex-shrink-0">
      <div class="px-6 pt-2 pb-6 sticky max-h-[calc(100vh-4rem)] overflow-y-auto">
        
        <div id="on-this-page-wrap">
          <h3 class="px-3 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">On this page</h3>
          <nav id="on-this-page" class="space-y-1 text-sm" aria-label="On this page"></nav>
        </div>
      </div>
    </aside>
  </div>

  <script>
    (function() {
      function slugify(text) {
        return text.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
      }
      var main = document.getElementById('content');
      var nav = document.getElementById('on-this-page');
      var wrap = document.getElementById('on-this-page-wrap');
      if (!main || !nav || !wrap) return;
      var headings = main.querySelectorAll('h2, h3');
      if (headings.length === 0) { wrap.style.display = 'none'; return; }
      var html = '';
      headings.forEach(function(h) {
        var id = h.id || slugify(h.textContent || '');
        if (!h.id) h.id = id;
        var indent = h.tagName === 'H3' ? ' pl-3' : '';
        html += '<a href="#' + id + '" class="block px-3 py-1 rounded-md text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white' + indent + '">' + (h.textContent || '').replace(/</g, '&lt;') + '</a>';
      });
      nav.innerHTML = html;
    })();

    // Deep link to folder in File Explorer: open ancestor details and scroll
    (function() {
      var hash = location.hash;
      if (!hash || !hash.startsWith('#dir-')) return;
      var el = document.getElementById(hash.slice(1));
      if (!el) return;
      var p = el.parentElement;
      while (p) {
        if (p.tagName === 'DETAILS') p.setAttribute('open', '');
        p = p.parentElement;
      }
      el.scrollIntoView({ behavior: 'smooth', block: 'center' });
    })();
  </script>

  <footer class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
    <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <!-- About Section -->
        <div>
          <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider mb-4">About Docs Kit MCP</h3>
          <p class="text-sm text-gray-600 dark:text-gray-400 leading-relaxed">
            An intelligent documentation agent that uses Tree-sitter AST analysis to detect semantic code changes and automatically keep your documentation in sync with your code.
          </p>
        </div>

        <!-- Links Section -->
        <div>
          <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider mb-4">Resources</h3>
          <ul class="space-y-2">
            <li>
              <a href="https://github.com/mpazaryna/docs-kit" target="_blank" rel="noopener noreferrer" class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 flex items-center gap-2">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                  <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/>
                </svg>
                GitHub Repository
              </a>
            </li>
            <li>
              <a href="../index.html" class="text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200">Documentation Home</a>
            </li>
            <li>
              <a href="../patterns.html" class="text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200">Patterns & Architecture</a>
            </li>
            <li>
              <a href="../governance.html" class="text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200">Code Quality</a>
            </li>
          </ul>
        </div>

        <!-- Info Section -->
        <div>
          <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider mb-4">Technology</h3>
          <ul class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
            <li class="flex items-center gap-2">
              <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              Tree-sitter AST Analysis
            </li>
            <li class="flex items-center gap-2">
              <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              Model Context Protocol (MCP)
            </li>
            <li class="flex items-center gap-2">
              <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              Semantic Change Detection
            </li>
            <li class="flex items-center gap-2">
              <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              SQLite Knowledge Base
            </li>
          </ul>
        </div>
      </div>

      <div class="mt-8 pt-8 border-t border-gray-200 dark:border-gray-700">
        <div class="flex flex-col md:flex-row justify-between items-center gap-4">
          <p class="text-sm text-gray-500 dark:text-gray-400">
            © 2026 Docs Kit MCP. Living connection between code & knowledge.
          </p>
          <div class="flex items-center gap-4">
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300">
              Powered by AI
            </span>
            <span class="text-xs text-gray-400 dark:text-gray-500">
              v1.0.0
            </span>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>
  <script>
    var INDEX = null;
    var FUSE = null;

    // Load search index
    fetch('../search.json')
      .then(function (r) { return r.json(); })
      .then(function (data) {
        if (Array.isArray(data)) {
          INDEX = { items: data };
        } else {
          INDEX = data;
        }
        try {
          FUSE = new Fuse(INDEX.items, { keys: [{ name: 'name', weight: 0.6 }, { name: 'signature', weight: 0.2 }, { name: 'summary', weight: 0.2 }], includeMatches: true, threshold: 0.35 });
        } catch (e) { console.warn('Fuse init failed', e); FUSE = null; }
      })
      .catch(function(e) {
        // Search index failed to load (CORS or network error)
        // This is expected when opening the site with file:// protocol
        console.warn('Search index not available:', e.message);
      });

    // Global search dropdown
    (function() {
      var input = document.getElementById('global-search');
      var panel = document.getElementById('global-search-results');
      var selectedIdx = -1;

      function hide() {
        panel.classList.add('hidden');
        panel.innerHTML = '';
        selectedIdx = -1;
        input.setAttribute('aria-expanded', 'false');
      }

      function show(items) {
        if (!items || items.length === 0) { hide(); return; }
        var html = '';
        items.slice(0, 10).forEach(function(it, i) {
          var href = it.id ? ('symbols/' + it.id + '.html') : '#';
          html += '<a role="option" id="search-opt-' + i + '" class="block px-4 py-2 text-sm text-left hover:bg-blue-50 dark:hover:bg-blue-900/50 focus:bg-blue-50 dark:focus:bg-blue-900/50 focus:outline-none border-b border-gray-100 dark:border-gray-700 last:border-0" href="' + href + '" tabindex="-1">' +
            '<span class="font-medium text-blue-600 dark:text-blue-400">' + (it.name || '').replace(/</g, '&lt;') + '</span>' +
            (it.kind ? ' <span class="text-gray-500 dark:text-gray-400 text-xs">' + it.kind + '</span>' : '') +
            (it.file ? '<br><span class="text-gray-400 dark:text-gray-500 text-xs">' + it.file + '</span>' : '') +
            '</a>';
        });
        panel.innerHTML = html;
        panel.classList.remove('hidden');
        input.setAttribute('aria-expanded', 'true');
        selectedIdx = 0;
        var first = document.getElementById('search-opt-0');
        if (first) first.classList.add('bg-blue-50', 'dark:bg-blue-900/50');
      }

      function getResults() {
        var q = input.value.trim();
        if (!q || !FUSE) return [];
        return FUSE.search(q).map(function(r) { return r.item; });
      }

      function navigate(step) {
        var opts = panel.querySelectorAll('[role="option"]');
        if (opts.length === 0) return;
        opts[selectedIdx].classList.remove('bg-blue-50', 'dark:bg-blue-900/50');
        selectedIdx = selectedIdx + step;
        if (selectedIdx < 0) selectedIdx = opts.length - 1;
        if (selectedIdx >= opts.length) selectedIdx = 0;
        opts[selectedIdx].classList.add('bg-blue-50', 'dark:bg-blue-900/50');
        opts[selectedIdx].focus();
      }

      input.addEventListener('input', function() {
        var items = getResults();
        show(items);
      });

      input.addEventListener('focus', function() {
        if (panel.innerHTML) panel.classList.remove('hidden');
      });

      input.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') { hide(); e.preventDefault(); return; }
        if (!panel.classList.contains('hidden') && panel.children.length) {
          if (e.key === 'ArrowDown') { navigate(1); e.preventDefault(); return; }
          if (e.key === 'ArrowUp') { navigate(-1); e.preventDefault(); return; }
          if (e.key === 'Enter' && selectedIdx >= 0) {
            var opt = document.getElementById('search-opt-' + selectedIdx);
            if (opt) { opt.click(); e.preventDefault(); }
          }
        }
      });

      document.addEventListener('click', function(e) {
        var wrap = document.getElementById('global-search-wrap');
        if (wrap && !wrap.contains(e.target)) hide();
      });

      panel.addEventListener('mousedown', function(e) {
        e.preventDefault();
      });

      document.addEventListener('keydown', function(e) {
        if (e.key !== '/' || e.ctrlKey || e.metaKey || e.altKey) return;
        var tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : '';
        if (tag === 'input' || tag === 'textarea' || (e.target && e.target.isContentEditable)) return;
        e.preventDefault();
        input.focus();
      });
    })();
  </script>

  <!-- Theme Toggle Script -->
  <script>
    (function() {
      var toggle = document.getElementById('theme-toggle');
      var hljsLight = document.getElementById('hljs-light');
      var hljsDark = document.getElementById('hljs-dark');

      function updateHighlightTheme(isDark) {
        if (hljsLight && hljsDark) {
          hljsLight.disabled = isDark;
          hljsDark.disabled = !isDark;
        }
      }

      function setTheme(isDark) {
        if (isDark) {
          document.documentElement.classList.add('dark');
          localStorage.setItem('docs-kit-theme', 'dark');
        } else {
          document.documentElement.classList.remove('dark');
          localStorage.setItem('docs-kit-theme', 'light');
        }
        updateHighlightTheme(isDark);
      }

      // Initialize theme on load
      var isDark = document.documentElement.classList.contains('dark');
      updateHighlightTheme(isDark);

      if (toggle) {
        toggle.addEventListener('click', function() {
          var isDark = document.documentElement.classList.contains('dark');
          setTheme(!isDark);
        });
      }

      // Listen for system theme changes
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
        if (!localStorage.getItem('docs-kit-theme')) {
          setTheme(e.matches);
        }
      });
    })();
  </script>

  <!-- Highlight.js Initialization -->
  <script>
    (function() {
      // Function to highlight all code blocks
      function highlightAllCodeBlocks() {
        if (typeof hljs !== 'undefined') {
          document.querySelectorAll('pre code:not(.hljs)').forEach(function(block) {
            try {
              hljs.highlightElement(block);
            } catch (e) {
              console.warn('Failed to highlight code block:', e);
            }
          });
        }
      }

      // Initialize syntax highlighting for all code blocks
      if (typeof hljs !== 'undefined') {
        // On DOMContentLoaded
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', highlightAllCodeBlocks);
        } else {
          // DOM is already ready, highlight immediately
          highlightAllCodeBlocks();
        }

        // Also run after a short delay to catch any dynamically added content
        setTimeout(highlightAllCodeBlocks, 100);
      }
    })();
  </script>
</body>
</html>