<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fill All - Configurações</title>
</head>
<body>
  <div class="container">
    <header>
      <h1>⚙️ Fill All — Configurações</h1>
    </header>

    <div class="tabs">
      <button class="tab active" data-tab="settings">Geral</button>
      <button class="tab" data-tab="rules">Regras</button>
      <button class="tab" data-tab="forms">Formulários Salvos</button>
      <button class="tab" data-tab="dataset">Dataset & Treino</button>
      <button class="tab" data-tab="cache">Cache & Aprendizado</button>
    </div>

    <!-- Settings Tab -->
    <div class="tab-content active" id="tab-settings">
      <div class="card">
        <h2>Configurações Gerais</h2>

        <div class="toggle-group">
          <div>
            <label>Preencher automaticamente</label>
            <div class="description">Preenche os campos ao carregar a página</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="setting-auto-fill" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="toggle-group">
          <div>
            <label>Destacar campos preenchidos</label>
            <div class="description">Adiciona borda visual e exibe o nome detectado nos campos preenchidos</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="setting-highlight" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="toggle-group">
          <div>
            <label>Cache de detecção</label>
            <div class="description">Guarda campos detectados por URL para carregamento rápido no popup</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="setting-cache-enabled" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="form-row" style="margin-top: 16px">
          <div class="form-group">
            <label for="setting-strategy">Estratégia padrão:</label>
            <select id="setting-strategy">
              <option value="ai">AI (Chrome AI / TensorFlow)</option>
              <option value="tensorflow">TensorFlow.js</option>
              <option value="random">Geradores aleatórios</option>
            </select>
          </div>
          <div class="form-group">
            <label for="setting-locale">Localidade:</label>
            <select id="setting-locale">
              <option value="pt-BR">Português (Brasil)</option>
              <option value="en-US">English (US)</option>
            </select>
          </div>
        </div>

        <button id="btn-save-settings" class="btn btn-primary">Salvar Configurações</button>
      </div>

      <!-- Field Icon Card -->
      <div class="card">
        <h2>Ícone de Campo</h2>
        <p class="description" style="margin-bottom: 16px; color: var(--text-muted); font-size: 13px;">
          Configure a exibição do ícone de preenchimento rápido que aparece ao focar em um campo.
        </p>

        <div class="toggle-group">
          <div>
            <label>Exibir ícone de campo</label>
            <div class="description">Mostra os botões de preencher, inspecionar e salvar regra ao focar num campo</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="setting-show-field-icon" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="form-group" id="field-icon-position-group" style="margin-top: 12px;">
          <label for="setting-field-icon-position">Posição do ícone:</label>
          <select id="setting-field-icon-position">
            <option value="above">Acima do campo</option>
            <option value="inside">Dentro do campo (à direita)</option>
            <option value="below">Abaixo do campo</option>
          </select>
          <div class="description" style="margin-top: 4px; font-size: 12px; color: var(--text-muted);">
            Recarregue a aba ativa para aplicar a mudança de posição.
          </div>
        </div>

        <button id="btn-save-field-icon" class="btn btn-primary" style="margin-top: 8px;">Salvar</button>
      </div>

      <!-- Detection Strategies Card -->
      <div class="card">
        <h2>Estratégias de Detecção</h2>
        <p class="description" style="margin-bottom: 12px; color: var(--text-muted); font-size: 13px;">
          Arraste para reordenar as estratégias. A extensão tenta cada estratégia habilitada na ordem listada até encontrar um resultado.
        </p>

        <div id="strategy-list" style="display: flex; flex-direction: column; gap: 6px;"></div>

        <div id="chrome-ai-status-block" style="display:none; margin-top: 12px; padding: 10px 14px; border-radius: 8px; font-size: 13px; border: 1px solid var(--border); background: var(--bg);">
          <div id="chrome-ai-status-text" style="color: var(--text-muted);"></div>
          <button id="btn-download-chrome-ai" class="btn btn-secondary" style="display:none; margin-top: 8px; font-size: 12px;">
            ⬇️ Iniciar download do modelo
          </button>
        </div>

        <button id="btn-save-strategies" class="btn btn-primary" style="margin-top: 12px;">Salvar Ordem</button>
      </div>
    </div>

    <!-- Rules Tab -->
    <div class="tab-content" id="tab-rules">
      <div class="card">
        <h2>Regras por Site</h2>
        <p class="description" style="margin-bottom: 16px; color: var(--text-muted); font-size: 13px;">
          Defina regras específicas para campos em sites diferentes. O campo "CPF" no site A pode ter um valor fixo, enquanto no site B é gerado automaticamente.
        </p>
        <div id="rules-list"></div>
      </div>

      <div class="card">
        <h2>Nova Regra</h2>
        <div class="form-row">
          <div class="form-group">
            <label for="rule-url">Padrão de URL (use * como coringa):</label>
            <input type="text" id="rule-url" placeholder="https://example.com/*" />
          </div>
          <div class="form-group">
            <label for="rule-selector">Seletor CSS do campo:</label>
            <input type="text" id="rule-selector" placeholder="#cpf, input[name='cpf']" />
          </div>
        </div>

        <div class="form-row-3">
          <div class="form-group">
            <label for="rule-field-name">Nome do campo (opcional):</label>
            <input type="text" id="rule-field-name" placeholder="cpf" />
          </div>
          <div class="form-group">
            <label for="rule-type">Tipo do campo:</label>
            <select id="rule-type">
              <option value="cpf">CPF</option>
              <option value="cnpj">CNPJ</option>
              <option value="email">E-mail</option>
              <option value="phone">Telefone</option>
              <option value="full-name">Nome Completo</option>
              <option value="first-name">Primeiro Nome</option>
              <option value="last-name">Sobrenome</option>
              <option value="address">Endereço</option>
              <option value="cep">CEP</option>
              <option value="rg">RG</option>
              <option value="date">Data</option>
              <option value="birth-date">Data de Nascimento</option>
              <option value="password">Senha</option>
              <option value="username">Usuário</option>
              <option value="company">Empresa</option>
              <option value="number">Número</option>
              <option value="text">Texto</option>
            </select>
          </div>
          <div class="form-group">
            <label for="rule-generator">Gerador:</label>
            <select id="rule-generator">
              <option value="auto">Automático</option>
              <option value="ai">Chrome AI</option>
              <option value="tensorflow">TensorFlow.js</option>
              <option value="cpf">CPF válido</option>
              <option value="cnpj">CNPJ válido</option>
              <option value="email">E-mail</option>
              <option value="phone">Telefone</option>
              <option value="full-name">Nome</option>
              <option value="cep">CEP</option>
              <option value="rg">RG</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="rule-fixed">Valor fixo (opcional):</label>
            <input type="text" id="rule-fixed" placeholder="123.456.789-09" />
          </div>
          <div class="form-group">
            <label for="rule-priority">Prioridade (maior = mais importante):</label>
            <input type="number" id="rule-priority" value="10" min="0" max="100" />
          </div>
        </div>

        <button id="btn-save-rule" class="btn btn-primary">Salvar Regra</button>
      </div>
    </div>

    <!-- Saved Forms Tab -->
    <div class="tab-content" id="tab-forms">
      <div class="card">
        <h2>Formulários Salvos</h2>
        <div id="saved-forms-list"></div>
      </div>
    </div>

    <!-- Dataset & Training Tab -->
    <div class="tab-content" id="tab-dataset">

      <!-- Model Status Card -->
      <div class="card">
        <h2>Estado do Modelo</h2>
        <div id="model-status-block" style="margin-bottom: 12px; padding: 12px; border-radius: 6px; background: var(--bg-secondary, #1e1e1e); border: 1px solid var(--border-color, #333); font-size: 13px; line-height: 1.7;">
          <div id="model-status-text" style="color: var(--text-muted, #888);">Verificando modelo...</div>
        </div>
        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
          <button id="btn-train-model" class="btn btn-primary">&#x1F9E0; Treinar Modelo</button>
          <button id="btn-delete-model" class="btn btn-delete" style="display:none;">&#x1F5D1; Remover Modelo Treinado</button>
        </div>

        <!-- Training Progress -->
        <div id="training-progress-block" style="display:none; margin-top: 16px;">
          <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: .5px;">Progresso do Treinamento</div>
          <div style="background: var(--bg-secondary, #1e1e1e); border-radius: 4px; overflow: hidden; height: 8px; margin-bottom: 8px; border: 1px solid var(--border-color);">
            <div id="training-progress-bar" style="height: 100%; background: #6366f1; width: 0%; transition: width .2s;"></div>
          </div>
          <div id="training-progress-label" style="font-size: 12px; color: var(--text-muted);">Epoch 0 / 0</div>
          <pre id="training-log" style="
            margin-top: 10px;
            background: var(--bg-secondary, #1e1e1e);
            color: var(--text-primary, #d4d4d4);
            font-size: 11px;
            line-height: 1.6;
            padding: 10px 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color, #333);
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-word;
            max-height: 200px;
            overflow-y: auto;
            margin: 8px 0 0;
          "></pre>
        </div>
      </div>

      <!-- Add Entry Card -->
      <div class="card">
        <h2>Adicionar Entrada ao Dataset</h2>
        <p class="description" style="color: var(--text-muted); font-size: 13px; margin-bottom: 14px;">
          Digite os sinais do campo como você os vê no HTML (label + name + id + placeholder concatenados).
          Ex: <code>cpf cpf_field digite seu cpf</code>
        </p>
        <div class="form-row">
          <div class="form-group" style="flex: 2;">
            <label for="dataset-signals">Sinais do campo:</label>
            <input type="text" id="dataset-signals" placeholder="cpf cpf_field digite seu cpf" />
          </div>
          <div class="form-group">
            <label for="dataset-type">Tipo:</label>
            <select id="dataset-type">
              <option value="cpf">CPF</option>
              <option value="cnpj">CNPJ</option>
              <option value="cpf-cnpj">CPF/CNPJ</option>
              <option value="rg">RG</option>
              <option value="email">E-mail</option>
              <option value="phone">Telefone</option>
              <option value="name">Nome</option>
              <option value="first-name">Primeiro Nome</option>
              <option value="last-name">Sobrenome</option>
              <option value="full-name">Nome Completo</option>
              <option value="address">Endereço</option>
              <option value="street">Rua</option>
              <option value="city">Cidade</option>
              <option value="state">Estado</option>
              <option value="cep">CEP</option>
              <option value="zip-code">ZIP Code</option>
              <option value="date">Data</option>
              <option value="birth-date">Data de Nascimento</option>
              <option value="password">Senha</option>
              <option value="username">Usuário</option>
              <option value="company">Empresa</option>
              <option value="website">Website</option>
              <option value="product">Produto</option>
              <option value="supplier">Fornecedor</option>
              <option value="employee-count">Nº Funcionários</option>
              <option value="job-title">Cargo</option>
              <option value="money">Valor Monetário</option>
              <option value="number">Número</option>
              <option value="text">Texto</option>
            </select>
          </div>
          <div class="form-group">
            <label for="dataset-difficulty">Dificuldade:</label>
            <select id="dataset-difficulty">
              <option value="easy">Fácil</option>
              <option value="medium">Médio</option>
              <option value="hard">Difícil</option>
            </select>
          </div>
        </div>
        <button id="btn-add-dataset-entry" class="btn btn-primary">Adicionar Entrada</button>
      </div>

      <!-- Dataset List Card -->
      <div class="card">
        <h2>Entradas do Dataset</h2>
        <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 14px; align-items: center;">
          <span id="dataset-count-badge" class="badge" style="font-size: 13px; padding: 4px 10px;">0 entradas</span>
          <button id="btn-seed-dataset" class="btn btn-secondary" style="font-size: 12px;">&#x1F331; Importar Dataset Padrão</button>
          <button id="btn-import-dataset" class="btn btn-secondary" style="font-size: 12px;">&#x1F4C2; Importar JSON</button>
          <button id="btn-export-dataset" class="btn btn-secondary" style="font-size: 12px;">&#x1F4E5; Exportar JSON</button>
          <button id="btn-clear-dataset" class="btn btn-delete" style="font-size: 12px;">&#x1F5D1; Limpar Dataset</button>
        </div>
        <input type="text" id="dataset-filter" placeholder="Filtrar por sinais ou tipo..." style="margin-bottom: 12px; width: 100%; box-sizing: border-box;" />
        <input type="file" id="dataset-import-file" accept=".json" style="display:none;" />
        <div id="dataset-list"></div>
      </div>
    </div>

    <!-- Cache & Learning Tab (renamed) -->
    <div class="tab-content" id="tab-cache">
      <div class="card">
        <h2>Cache de Detecção por Página</h2>
        <p class="description" style="margin-bottom: 16px; color: var(--text-muted); font-size: 13px;">
          Guarda os campos detectados por URL para que o popup recupere o estado rapidamente.
        </p>
        <div style="display:flex; gap:8px; margin-bottom:16px;">
          <button id="btn-refresh-cache" class="btn btn-primary">Atualizar</button>
          <button id="btn-clear-cache" class="btn btn-delete">Limpar Todo Cache</button>
        </div>
        <div id="cache-list"></div>
      </div>

      <div class="card">
        <h2>Aprendizado e Retreino</h2>
        <p class="description" style="margin-bottom: 8px; color: var(--text-muted); font-size: 13px;">
          <strong>O que o "Retreinar pelo Browser" faz:</strong> salva as regras como <em>vetores de aprendizado</em>
          (camada de similaridade de cosseno). É rápido e funciona sem npm.<br>
          <strong>O que não faz:</strong> <u>não altera os pesos da rede neural TF.js</u>.
          Para retreinar o modelo neural, use <code>npm run train:model</code> no terminal.
        </p>
        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px;">
          <button id="btn-retrain-learning" class="btn btn-primary">&#x1F9E0; Retreinar Vetores (Browser)</button>
          <button id="btn-export-rules-dataset" class="btn btn-secondary">&#x1F4E5; Exportar Regras (npm)</button>
          <button id="btn-clear-learning" class="btn btn-delete">Limpar Aprendizado</button>
        </div>
        <div id="retrain-log-box" style="display:none; margin-bottom:12px;">
          <div style="font-size:11px; font-weight:600; color:var(--text-muted); margin-bottom:4px; text-transform:uppercase; letter-spacing:.5px;">Log do Retreino</div>
          <pre id="retrain-log" style="
            background:var(--bg-secondary,#1e1e1e);
            color:var(--text-primary,#d4d4d4);
            font-size:11px;
            line-height:1.6;
            padding:10px 12px;
            border-radius:6px;
            border:1px solid var(--border-color,#333);
            overflow-x:auto;
            white-space:pre-wrap;
            word-break:break-word;
            max-height:260px;
            overflow-y:auto;
            margin:0;
          "></pre>
        </div>
        <div id="learning-summary" class="empty" style="padding: 10px 0; text-align:left;"></div>
        <div id="learned-list"></div>
      </div>
    </div>
  </div>

  <script type="module" src="./options.ts"></script>
</body>
</html>
