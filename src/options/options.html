<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="optionsPageTitle">Fill All — Settings</title>
</head>
<body>
  <div class="container">
    <header>
      <h1 data-i18n="optionsHeader">⚙️ Fill All — Settings</h1>
    </header>

    <div class="tabs">
      <button class="tab active" data-tab="settings" data-i18n="tabGeneral">General</button>
      <button class="tab" data-tab="rules" data-i18n="tabRules">Rules</button>
      <button class="tab" data-tab="forms" data-i18n="tabSavedForms">Saved Forms</button>
      <button class="tab" data-tab="dataset" data-i18n="tabDataset">Dataset &amp; Training</button>
      <button class="tab" data-tab="cache" data-i18n="tabCacheAndLearning">Cache &amp; Learning</button>
      <button class="tab" data-tab="log" data-i18n="tabLog">Log</button>
    </div>

    <!-- Settings Tab -->
    <div class="tab-content active" id="tab-settings">

      <!-- Language & Locale Card -->
      <div class="card">
        <h2 data-i18n="settingLanguageTitle">Language &amp; Locale</h2>

        <div class="form-group" style="margin-bottom: 16px;">
          <label for="setting-ui-language" data-i18n="settingUiLanguage">Interface language:</label>
          <select id="setting-ui-language">
            <option value="auto" data-i18n="uiLangAuto">Auto (browser default)</option>
            <option value="en" data-i18n="uiLangEn">English</option>
            <option value="pt_BR" data-i18n="uiLangPtBr">Português (Brasil)</option>
            <option value="es" data-i18n="uiLangEs">Español</option>
          </select>
          <div class="description" style="margin-top: 4px; font-size: 12px; color: var(--text-muted);" data-i18n="settingUiLanguageDesc">
            Select the language for the extension interface.
          </div>
        </div>

        <div class="form-group">
          <label for="setting-locale" data-i18n="settingDataLocale">Data generation locale:</label>
          <select id="setting-locale">
            <option value="pt-BR" data-i18n="localePtBr">Português (Brasil)</option>
            <option value="en-US" data-i18n="localeEnUs">English (US)</option>
          </select>
          <div class="description" style="margin-top: 4px; font-size: 12px; color: var(--text-muted);" data-i18n="settingDataLocaleDesc">
            Controls the format of generated data (CPF/CNPJ for pt-BR, SSN/EIN for en-US).
          </div>
        </div>

      </div>

      <!-- General Settings Card -->
      <div class="card">
        <h2 data-i18n="settingsGeneralTitle">General Settings</h2>

        <div class="toggle-group">
          <div>
            <label data-i18n="settingHighlight">Highlight filled fields</label>
            <div class="description" data-i18n="settingHighlightDesc">Adds a visual border and shows the detected name on filled fields</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="setting-highlight" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="toggle-group">
          <div>
            <label data-i18n="settingCacheEnabled">Detection cache</label>
            <div class="description" data-i18n="settingCacheEnabledDesc">Stores detected fields per URL for fast popup loading</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="setting-cache-enabled" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="toggle-group">
          <div>
            <label data-i18n="settingShowPanel">Floating Panel</label>
            <div class="description" data-i18n="settingShowPanelDesc">Automatically shows the floating controls panel on all pages</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="setting-show-panel" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="toggle-group">
          <div>
            <label data-i18n="settingFillEmptyOnly">Fill only empty fields</label>
            <div class="description" data-i18n="settingFillEmptyOnlyDesc">Skips fields that already have a value</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="setting-fill-empty-only" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="toggle-group" style="margin-top: 16px">
          <div>
            <label data-i18n="settingDebugLogs">Diagnostic logs</label>
            <div class="description" data-i18n="settingDebugLogsDesc">Shows debug messages in the browser console</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="setting-debug-log" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="form-group" id="log-level-group" style="margin-top: 8px">
          <label for="setting-log-level" data-i18n="settingLogLevel">Minimum log level:</label>
          <select id="setting-log-level">
            <option value="debug" data-i18n="logLevelDebug">Debug (all)</option>
            <option value="info" data-i18n="logLevelInfo">Info</option>
            <option value="warn" data-i18n="logLevelWarn">Warn</option>
            <option value="error" data-i18n="logLevelError">Error (errors only)</option>
          </select>
        </div>

      </div>

      <!-- Field Icon Card -->
      <div class="card">
        <h2 data-i18n="fieldIconTitle">Field Icon</h2>
        <p class="description" style="margin-bottom: 16px; color: var(--text-muted); font-size: 13px;" data-i18n="fieldIconConfigDesc">
          Configure the display of the quick-fill icon that appears when focusing a field.
        </p>

        <div class="toggle-group">
          <div>
            <label data-i18n="settingShowFieldIcon">Show field icon</label>
            <div class="description" data-i18n="settingShowFieldIconDesc">Shows the fill and save-rule button when focusing a field</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="setting-show-field-icon" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="form-group" id="field-icon-position-group" style="margin-top: 12px;">
          <label for="setting-field-icon-position" data-i18n="settingFieldIconPosition">Icon position:</label>
          <select id="setting-field-icon-position">
            <option value="above" data-i18n="iconAbove">Above the field</option>
            <option value="inside" data-i18n="iconInside">Inside the field (right)</option>
            <option value="below" data-i18n="iconBelow">Below the field</option>
          </select>
          <div class="description" style="margin-top: 4px; font-size: 12px; color: var(--text-muted);" data-i18n="iconPositionReloadNote">
            Reload the active tab to apply the position change.
          </div>
        </div>

      </div>

      <!-- Detection Strategies Card -->
      <div class="card">
        <h2 data-i18n="detectionStrategiesTitle">Detection Strategies</h2>
        <p class="description" style="margin-bottom: 12px; color: var(--text-muted); font-size: 13px;" data-i18n="detectionStrategiesDesc">
          Drag to reorder strategies. The extension tries each enabled strategy in the listed order until it finds a result.
        </p>

        <div id="strategy-list" style="display: flex; flex-direction: column; gap: 6px;"></div>

        <div id="chrome-ai-status-block" style="display:none; margin-top: 12px; padding: 10px 14px; border-radius: 8px; font-size: 13px; border: 1px solid var(--border); background: var(--bg);">
          <div id="chrome-ai-status-text" style="color: var(--text-muted);"></div>
          <button id="btn-download-chrome-ai" class="btn btn-secondary" style="display:none; margin-top: 8px; font-size: 12px;" data-i18n="btnDownloadNow">
            ⬇️ Start model download
          </button>
        </div>

      </div>
    </div>

    <!-- Rules Tab -->
    <div class="tab-content" id="tab-rules">
      <div class="card">
        <h2 data-i18n="rulesSectionTitle">Rules by Site</h2>
        <p class="description" style="margin-bottom: 16px; color: var(--text-muted); font-size: 13px;" data-i18n="rulesSectionDesc">
          Define specific rules for fields on different sites.
        </p>
        <div id="rules-list"></div>
      </div>

      <div class="card">
        <h2 data-i18n="newRuleTitle">New Rule</h2>
        <div class="form-row">
          <div class="form-group">
            <label for="rule-url" data-i18n="ruleUrlPatternLabel">URL Pattern (use * as wildcard):</label>
            <input type="text" id="rule-url" data-i18n-placeholder="ruleUrlPatternPlaceholder" placeholder="https://example.com/*" />
          </div>
          <div class="form-group">
            <label for="rule-selector" data-i18n="ruleSelectorLabel">Field CSS selector:</label>
            <input type="text" id="rule-selector" placeholder="#cpf, input[name='cpf']" />
          </div>
        </div>

        <div class="form-row-3">
          <div class="form-group">
            <label for="rule-field-name" data-i18n="ruleFieldNameLabel">Field name (optional):</label>
            <input type="text" id="rule-field-name" placeholder="cpf" />
          </div>
          <div class="form-group">
            <label for="rule-type" data-i18n="ruleFieldTypeLabel">Field type:</label>
            <select id="rule-type">
              <!-- filled dynamically -->
            </select>
          </div>
          <div class="form-group">
            <label for="rule-generator" data-i18n="ruleGeneratorLabel">Generator:</label>
            <select id="rule-generator">
              <!-- filled dynamically -->
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="rule-fixed" data-i18n="ruleFixedValueLabel">Fixed value (optional):</label>
            <input type="text" id="rule-fixed" data-i18n-placeholder="ruleFixedValuePlaceholder" placeholder="123.456.789-09" />
          </div>
          <div class="form-group">
            <label for="rule-priority" data-i18n="rulePriorityLabel">Priority (higher = more important):</label>
            <input type="number" id="rule-priority" value="10" min="0" max="100" />
          </div>
        </div>

        <div style="display: flex; gap: 8px;">
          <button id="btn-save-rule" class="btn btn-primary" data-i18n="btnSaveRule">Save Rule</button>
          <button id="btn-cancel-rule" class="btn btn-secondary" style="display: none;" data-i18n="btnCancelRule">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Saved Forms Tab -->
    <div class="tab-content" id="tab-forms">
      <div class="card">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
          <h2 style="margin:0;" data-i18n="formsTabTitle">Saved Forms</h2>
          <div style="display:flex;gap:8px;align-items:center;">
            <button id="btn-import-forms" class="btn btn-secondary btn-sm" data-i18n-title="btnImport" data-i18n="btnImport">⬇ Import</button>
            <button id="btn-export-forms" class="btn btn-secondary btn-sm" data-i18n-title="btnExport" data-i18n="btnExport">⬆ Export</button>
            <button id="btn-create-template" class="btn btn-primary btn-sm" data-i18n="btnCreateTemplate">+ Create Template</button>
          </div>
        </div>
        <input type="file" id="import-forms-file" accept=".json" style="display:none;" />
        <div class="description" style="font-size:12px;color:var(--text-muted);margin-bottom:14px;" data-i18n="formsTabDesc">
          Templates define default values per field type (CPF, name, date…) and apply on any site where those fields are detected.
        </div>
        <div id="saved-forms-list"></div>
      </div>
    </div>

    <!-- Dataset & Training Tab -->
    <div class="tab-content" id="tab-dataset">

      <!-- Model Status Card -->
      <div class="card">
        <h2 data-i18n="modelStatusTitle">Model Status</h2>
        <div id="model-status-block" style="margin-bottom: 12px; padding: 12px; border-radius: 6px; background: var(--bg-secondary, #1e1e1e); border: 1px solid var(--border-color, #333); font-size: 13px; line-height: 1.7;">
          <div id="model-status-text" style="color: var(--text-muted, #888);" data-i18n="checkingModel">Checking model...</div>
        </div>
        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
          <button id="btn-train-model" class="btn btn-primary" data-i18n="btnTrainModel">&#x1F9E0; Train Model</button>
          <button id="btn-delete-model" class="btn btn-delete" style="display:none;" data-i18n="btnDeleteModel">&#x1F5D1; Remove Trained Model</button>
        </div>

        <!-- Training Progress -->
        <div id="training-progress-block" style="display:none; margin-top: 16px;">
          <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: .5px;" data-i18n="trainingProgressTitle">Training Progress</div>
          <div style="background: var(--bg-secondary, #1e1e1e); border-radius: 4px; overflow: hidden; height: 8px; margin-bottom: 8px; border: 1px solid var(--border-color);">
            <div id="training-progress-bar" style="height: 100%; background: #6366f1; width: 0%; transition: width .2s;"></div>
          </div>
          <div id="training-progress-label" style="font-size: 12px; color: var(--text-muted);">Epoch 0 / 0</div>
          <pre id="training-log" style="
            margin-top: 10px;
            background: var(--bg-secondary, #1e1e1e);
            color: var(--text-primary, #d4d4d4);
            font-size: 11px;
            line-height: 1.6;
            padding: 10px 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color, #333);
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-word;
            max-height: 200px;
            overflow-y: auto;
            margin: 8px 0 0;
          "></pre>
        </div>
      </div>

      <!-- Add Entry Card -->
      <div class="card">
        <h2 data-i18n="addDatasetEntryTitle">Add Dataset Entry</h2>
        <p class="description" style="color: var(--text-muted); font-size: 13px; margin-bottom: 14px;" data-i18n="datasetEntryDesc">
          Type the field signals as you see them in the HTML (label + name + id + placeholder concatenated).
        </p>
        <div class="form-row">
          <div class="form-group" style="flex: 2;">
            <label for="dataset-signals" data-i18n="datasetSignalsLabel">Field signals:</label>
            <input type="text" id="dataset-signals" placeholder="cpf cpf_field type your cpf" />
          </div>
          <div class="form-group">
            <label for="dataset-type" data-i18n="datasetTypeLabel">Type:</label>
            <select id="dataset-type">
              <!-- filled dynamically -->
            </select>
          </div>
          <div class="form-group">
            <label for="dataset-difficulty" data-i18n="datasetDifficultyLabel">Difficulty:</label>
            <select id="dataset-difficulty">
              <option value="easy" data-i18n="difficultyEasy">Easy</option>
              <option value="medium" data-i18n="difficultyMedium">Medium</option>
              <option value="hard" data-i18n="difficultyHard">Hard</option>
            </select>
          </div>
        </div>
        <button id="btn-add-dataset-entry" class="btn btn-primary" data-i18n="btnAddDatasetEntry">Add Entry</button>
      </div>

      <!-- Dataset List Card -->
      <div class="card">
        <h2 data-i18n="datasetEntriesTitle">Dataset Entries</h2>
        <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 14px; align-items: center;">
          <span id="dataset-count-badge" class="badge" style="font-size: 13px; padding: 4px 10px;">0</span>
          <button id="btn-seed-dataset" class="btn btn-secondary" style="font-size: 12px;" data-i18n="btnSeedDataset">&#x1F331; Import Default Dataset</button>
          <button id="btn-import-dataset" class="btn btn-secondary" style="font-size: 12px;" data-i18n="btnImportDataset">&#x1F4C2; Import JSON</button>
          <button id="btn-export-dataset" class="btn btn-secondary" style="font-size: 12px;" data-i18n="btnExportDataset">&#x1F4E5; Export JSON</button>
          <button id="btn-clear-dataset" class="btn btn-delete" style="font-size: 12px;" data-i18n="btnClearDataset">&#x1F5D1; Clear Dataset</button>
        </div>
        <input type="text" id="dataset-filter" data-i18n-placeholder="datasetFilterPlaceholder" placeholder="Filter by signals or type;" />
        <div id="dataset-list"></div>
      </div>
    </div>

    <!-- Cache & Learning Tab (renamed) -->
    <div class="tab-content" id="tab-cache">
      <div class="card">
        <h2 data-i18n="cacheTabTitle">Detection Cache per Page</h2>
        <p class="description" style="margin-bottom: 16px; color: var(--text-muted); font-size: 13px;" data-i18n="cacheTabDesc">
          Stores detected fields per URL so the popup can recover state quickly.
        </p>
        <div style="display:flex; gap:8px; margin-bottom:16px;">
          <button id="btn-refresh-cache" class="btn btn-primary" data-i18n="btnRefreshCacheLabel">Refresh</button>
          <button id="btn-clear-cache" class="btn btn-delete" data-i18n="btnClearCacheLabel">Clear All Cache</button>
        </div>
        <div id="cache-list"></div>
      </div>

      <div class="card">
        <h2 data-i18n="learningTitle">Learning</h2>
        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px;">
          <button id="btn-clear-learning" class="btn btn-delete" data-i18n="btnClearLearningLabel">Clear Learning</button>
        </div>
        <div id="learning-summary" class="empty" style="padding: 10px 0; text-align:left;"></div>
        <div id="learned-list"></div>
      </div>
    </div>

    <!-- Log Tab -->
    <div class="tab-content" id="tab-log">
      <div class="card" style="height:calc(100vh - 200px);display:flex;flex-direction:column;">
        <div id="options-log-viewer" style="flex:1;display:flex;flex-direction:column;overflow:hidden;"></div>
      </div>
    </div>
  </div>

  <script type="module" src="./options.ts"></script>
</body>
</html>
